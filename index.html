<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QuaternionICP: QuaternionICP</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">QuaternionICP
   </div>
   <div id="projectbrief">Multi-view point cloud registration using ray-projected ICP</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">QuaternionICP </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a> Multi-view point cloud registration using ray-projected <a class="el" href="namespaceICP.html">ICP</a> with quaternion parameterization.</p>
<p><a href="https://jensmunkhansen.github.io/QuaternionICP/"><img src="https://img.shields.io/badge/docs-GitHub%20Pages-blue" alt="Documentation" class="inline"/></a></p>
<p><img src="DentalRegistration.png" alt="" class="inline" title="Dental Registration"/>     <em>Poor initial registration of dental scans. Left: index-based coloring. Right: real colors.</em></p>
<h1><a class="anchor" id="autotoc_md1"></a>
Dependencies</h1>
<p><b>Required (built by <code>dependencies.sh</code>):</b></p><ul>
<li>Eigen3 - Linear algebra</li>
<li>Ceres Solver - Nonlinear least squares</li>
<li>Abseil - C++ utilities (Ceres dependency)</li>
<li>Sophus - Lie groups (SE3/SO3)</li>
<li>tinyexr + miniz - EXR file loading</li>
<li>GridSearch + SIMDMath - Spatial search</li>
<li>args - Command-line parsing</li>
<li>Catch2 - Testing framework</li>
</ul>
<p><b>Optional:</b></p><ul>
<li>Intel MKL - LAPACK/BLAS acceleration for Ceres</li>
<li>TBB - Threading for Ceres (<code>sudo apt install libtbb-dev</code>)</li>
<li>CUDA - GPU acceleration for Ceres</li>
<li>SuiteSparse - Sparse Cholesky solvers</li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
Building</h1>
<h2><a class="anchor" id="autotoc_md3"></a>
1. Build Dependencies</h2>
<div class="fragment"><div class="line">./dependencies.sh                      # Default build (GCC)</div>
<div class="line">./dependencies.sh --compiler=clang     # Build with Clang</div>
<div class="line">./dependencies.sh --help               # Show all options</div>
</div><!-- fragment --><p><b>Optional features:</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Flag   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadNone">Requirements    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>-DUSE_MKL=ON</code>   </td><td class="markdownTableBodyNone">Intel MKL for LAPACK/BLAS   </td><td class="markdownTableBodyNone"><code>export MKLROOT=/opt/intel/oneapi/mkl/latest</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>-DUSE_TBB=ON</code>   </td><td class="markdownTableBodyNone">TBB threading in Ceres   </td><td class="markdownTableBodyNone"><code>sudo apt install libtbb-dev</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>-DUSE_CUDA=ON</code>   </td><td class="markdownTableBodyNone">CUDA GPU acceleration   </td><td class="markdownTableBodyNone">CUDA toolkit installed    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>-DUSE_SUITESPARSE=ON</code>   </td><td class="markdownTableBodyNone">Sparse solvers   </td><td class="markdownTableBodyNone">Combined with CUDA for GPU sparse   </td></tr>
</table>
<p><b>Examples:</b></p>
<div class="fragment"><div class="line"># MKL + TBB (recommended for CPU performance)</div>
<div class="line">export MKLROOT=/opt/intel/oneapi/mkl/latest</div>
<div class="line">./dependencies.sh -DUSE_MKL=ON -DUSE_TBB=ON</div>
<div class="line"> </div>
<div class="line"># CUDA for GPU-accelerated dense solvers</div>
<div class="line">./dependencies.sh -DUSE_CUDA=ON</div>
<div class="line"> </div>
<div class="line"># CUDA + SuiteSparse for GPU-accelerated sparse solvers</div>
<div class="line">./dependencies.sh -DUSE_CUDA=ON -DUSE_SUITESPARSE=ON</div>
<div class="line"> </div>
<div class="line"># Full configuration (MKL, TBB, CUDA, SuiteSparse)</div>
<div class="line">export MKLROOT=/opt/intel/oneapi/mkl/latest</div>
<div class="line">./dependencies.sh -DUSE_MKL=ON -DUSE_TBB=ON -DUSE_CUDA=ON -DUSE_SUITESPARSE=ON</div>
</div><!-- fragment --><p><b>Ceres Linear Solver Availability:</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Linear Solver   </th><th class="markdownTableHeadNone">Flags   </th><th class="markdownTableHeadNone">Backend    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DENSE_QR   </td><td class="markdownTableBodyNone">(none)   </td><td class="markdownTableBodyNone">Eigen    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">DENSE_SCHUR   </td><td class="markdownTableBodyNone">(none)   </td><td class="markdownTableBodyNone">Eigen    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">SPARSE_SCHUR   </td><td class="markdownTableBodyNone">(none)   </td><td class="markdownTableBodyNone">Eigen sparse    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SPARSE_SCHUR   </td><td class="markdownTableBodyNone"><code>-DUSE_SUITESPARSE=ON</code>   </td><td class="markdownTableBodyNone">CHOLMOD (faster)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">SPARSE_NORMAL_CHOLESKY   </td><td class="markdownTableBodyNone">(none)   </td><td class="markdownTableBodyNone">Eigen sparse    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SPARSE_NORMAL_CHOLESKY   </td><td class="markdownTableBodyNone"><code>-DUSE_SUITESPARSE=ON</code>   </td><td class="markdownTableBodyNone">CHOLMOD (faster)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CUDA_DENSE_CHOLESKY   </td><td class="markdownTableBodyNone"><code>-DUSE_CUDA=ON</code>   </td><td class="markdownTableBodyNone">cuSOLVER    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">CUDA_SPARSE_CHOLESKY   </td><td class="markdownTableBodyNone"><code>-DUSE_CUDA=ON -DUSE_SUITESPARSE=ON</code>   </td><td class="markdownTableBodyNone">cuSPARSE + CHOLMOD   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md4"></a>
2. Build Project</h2>
<div class="fragment"><div class="line">cmake --preset linux-gcc</div>
<div class="line">cmake --build build/linux-gcc</div>
</div><!-- fragment --><p><b>Available presets:</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Preset   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>linux-gcc</code>   </td><td class="markdownTableBodyNone">GCC with MKL support (default)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>linux-gcc-nomkl</code>   </td><td class="markdownTableBodyNone">GCC without MKL    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>linux-clang</code>   </td><td class="markdownTableBodyNone">Clang build   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md5"></a>
3. Run Tests</h2>
<div class="fragment"><div class="line">ctest --test-dir build/linux-gcc -C Debug</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md6"></a>
Important: MKL Configuration</h1>
<p>If you built dependencies with <code>-DUSE_MKL=ON</code>, you <b>must</b> use a preset with MKL enabled (<code>linux-gcc</code>). The MKL shared libraries need to be in the binary's RUNPATH.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Dependencies built with   </th><th class="markdownTableHeadNone">Use preset    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>-DUSE_MKL=ON</code>   </td><td class="markdownTableBodyNone"><code>linux-gcc</code> (default)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">No MKL flag   </td><td class="markdownTableBodyNone"><code>linux-gcc-nomkl</code>   </td></tr>
</table>
<p>Mismatched configurations will cause runtime errors like: </p><div class="fragment"><div class="line">error while loading shared libraries: libmkl_intel_lp64.so.2: cannot open shared object file</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md7"></a>
Usage</h1>
<h2><a class="anchor" id="autotoc_md8"></a>
SingleICP</h2>
<p>Register two depth grids:</p>
<div class="fragment"><div class="line">./build/linux-gcc/Debug/bin/SingleICPMain --source &lt;source.exr&gt; --target &lt;target.exr&gt;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md9"></a>
MultiICP</h2>
<p>Register multiple grids from a folder:</p>
<div class="fragment"><div class="line">./build/linux-gcc/Debug/bin/MultiICPMain --grid-folder &lt;folder&gt;</div>
</div><!-- fragment --><p>Or register two grids:</p>
<div class="fragment"><div class="line">./build/linux-gcc/Debug/bin/MultiICPMain --source &lt;source.exr&gt; --target &lt;target.exr&gt;</div>
</div><!-- fragment --><p>Use <code>--help</code> for all options.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
Project Structure</h1>
<div class="fragment"><div class="line">QuaternionICP/</div>
<div class="line">├── ICP/                 # Core ICP library</div>
<div class="line">├── SingleICP/           # Single-pair registration executable</div>
<div class="line">├── MultiICP/            # Multi-view registration executable</div>
<div class="line">├── ICPTest/             # Unit tests</div>
<div class="line">├── NativeDeps/          # Dependency build system</div>
<div class="line">├── CMake/               # CMake modules</div>
<div class="line">└── Doc/                 # Documentation (Doxygen)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md11"></a>
Documentation</h1>
<p>Generate Doxygen documentation:</p>
<div class="fragment"><div class="line">cmake --build build/linux-gcc --target doc</div>
</div><!-- fragment --><p>Output: <code>build/linux-gcc/doc/html/index.html</code></p>
<h1><a class="anchor" id="autotoc_md12"></a>
Continuous Integration</h1>
<p>The CI workflow runs on Ubuntu 24.04 with a minimal dependency configuration:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Component   </th><th class="markdownTableHeadNone">CI Configuration    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Intersection backend   </td><td class="markdownTableBodyNone">Embree 4 (system <code>libembree-dev</code>)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Nonlinear solver   </td><td class="markdownTableBodyNone">Ceres 2.2 (system <code>libceres-dev</code>)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Sparse solvers   </td><td class="markdownTableBodyNone">SuiteSparse (via <code>libceres-dev</code>)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Intel MKL   </td><td class="markdownTableBodyNone">Disabled    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">GridSearch   </td><td class="markdownTableBodyNone">Disabled (requires private repo)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SIMDMath   </td><td class="markdownTableBodyNone">Disabled (requires private repo)   </td></tr>
</table>
<p>Dependencies built from source: Eigen3, Sophus, Catch2, args, miniz, tinyexr.</p>
<p>The CI uses <code>linux-gcc-ci</code> and <code>linux-clang-ci</code> presets which set <code>USE_EMBREE=ON</code> and <code>USE_GRIDSEARCH=OFF</code>. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
