<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QuaternionICP: Interpreting FD Results for the Simplified Jacobian</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">QuaternionICP
   </div>
   <div id="projectbrief">Multi-view point cloud registration using ray-projected ICP</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('simplified_jacobian_analysis.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Interpreting FD Results for the Simplified Jacobian</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This document explains why the simplified Jacobian (dropping the denominator derivative) shows the observed errors for rotation components, and why the measured results are correct and expected.</p>
<p>Assumptions:</p><ul>
<li>Residual \(r = a/b\)</li>
<li>Right-multiplication on SE(3)</li>
<li>Finite-difference (FD) results taken as ground truth</li>
</ul>
<h1><a class="anchor" id="sja_results"></a>
Measured Results</h1>
<p>Observed FD sweep results for rotation components:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Direction   </th><th class="markdownTableHeadNone">FD (truth)   </th><th class="markdownTableHeadNone">Consistent   </th><th class="markdownTableHeadNone">Simplified   </th><th class="markdownTableHeadNone">Error   </th><th class="markdownTableHeadNone">Best \(\varepsilon\)    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">\(\omega_0\)   </td><td class="markdownTableBodyNone">\(-0.2504\)   </td><td class="markdownTableBodyNone">\(-0.2504\)   </td><td class="markdownTableBodyNone">\(-0.2420\)   </td><td class="markdownTableBodyNone">0.0084   </td><td class="markdownTableBodyNone">\(3 \times 10^{-6}\)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">\(\omega_1\)   </td><td class="markdownTableBodyNone">\(-0.1742\)   </td><td class="markdownTableBodyNone">\(-0.1742\)   </td><td class="markdownTableBodyNone">\(-0.1636\)   </td><td class="markdownTableBodyNone">0.0106   </td><td class="markdownTableBodyNone">\(3 \times 10^{-6}\)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">\(\omega_2\)   </td><td class="markdownTableBodyNone">\(-0.1144\)   </td><td class="markdownTableBodyNone">\(-0.1144\)   </td><td class="markdownTableBodyNone">\(-0.1092\)   </td><td class="markdownTableBodyNone">0.0052   </td><td class="markdownTableBodyNone">\(1 \times 10^{-5}\)   </td></tr>
</table>
<p>Observations:</p><ul>
<li>FD and consistent match exactly (to numerical precision)</li>
<li>Simplified deviates by roughly 0.5% to 1% absolute magnitude</li>
<li>Best epsilon is around \(10^{-6}\), as expected for rotation</li>
</ul>
<h1><a class="anchor" id="sja_missing_term"></a>
What the Simplified Jacobian is Missing</h1>
<p>The residual is:  </p><p class="formulaDsp">
\[
  r = \frac{a}{b}
\]
</p>
<p>where:  </p><p class="formulaDsp">
\[
  a = \mathbf{n}^\top (R\mathbf{p} + \mathbf{t} - \mathbf{q}), \qquad
  b = \mathbf{n}^\top (R\mathbf{d})
\]
</p>
<p><b>Consistent Jacobian</b> (full quotient rule):  </p><p class="formulaDsp">
\[
  \frac{\partial r}{\partial \boldsymbol{\omega}}
  = \frac{b \dfrac{\partial a}{\partial \boldsymbol{\omega}}
        - a \dfrac{\partial b}{\partial \boldsymbol{\omega}}}{b^2}
\]
</p>
<p><b>Simplified Jacobian</b> (ignores denominator derivative):  </p><p class="formulaDsp">
\[
  \left.\frac{\partial r}{\partial \boldsymbol{\omega}}\right|_{\text{simp}}
  = \frac{1}{b}\frac{\partial a}{\partial \boldsymbol{\omega}}
\]
</p>
<p>The difference is exactly the missing first-order term:  </p><p class="formulaDsp">
\[
  \Delta = \frac{\partial r}{\partial \boldsymbol{\omega}}\bigg|_{\text{cons}}
         - \frac{\partial r}{\partial \boldsymbol{\omega}}\bigg|_{\text{simp}}
         = -\frac{a}{b^2}\frac{\partial b}{\partial \boldsymbol{\omega}}
\]
</p>
<h1><a class="anchor" id="sja_error_magnitude"></a>
Why the Simplified Error is Around 0.005 to 0.01</h1>
<p>The magnitude of the missing term:  </p><p class="formulaDsp">
\[
  |\Delta| \approx \frac{|a| \cdot |\partial b/\partial\boldsymbol{\omega}|}{b^2}
\]
</p>
<p>This term is non-negligible when:</p><ul>
<li>The residual \(a\) is not small (early or mid <a class="el" href="namespaceICP.html">ICP</a> iterations)</li>
<li>\(b = \mathbf{n}^\top\mathbf{d}\) is not close to 1</li>
<li>The ray direction changes noticeably under rotation</li>
</ul>
<p>The measured numbers match this exactly:</p><ul>
<li>Errors on the order of 0.005 to 0.01</li>
<li>Jacobian entries on the order of 0.1 to 0.25</li>
<li>Relative errors of a few percent</li>
</ul>
<h1><a class="anchor" id="sja_consistent_validated"></a>
Why the Consistent Jacobian Matches FD</h1>
<p>Finite differences approximate the true derivative of the residual.</p>
<p>Because:</p><ol type="1">
<li>Epsilon was swept over multiple decades</li>
<li>A plateau was found around \(10^{-6}\)</li>
<li>The consistent Jacobian lies on that plateau</li>
</ol>
<p>The consistent Jacobian is validated. This confirms:</p><ul>
<li>The quotient-rule term is required</li>
<li>The analytic derivation is correct</li>
</ul>
<h1><a class="anchor" id="sja_best_eps"></a>
Why Optimal Epsilon Remains 1e-6 for Simplified</h1>
<p>The FD epsilon sweep reflects the smoothness of the <b>true residual</b>, not the analytic approximation chosen.</p>
<p>Therefore:</p><ul>
<li>Best \(\varepsilon\) is determined by \(r(\boldsymbol{\omega})\), not by the Jacobian formula</li>
<li>Best \(\varepsilon\) remains around \(10^{-6}\) even when the simplified Jacobian is wrong</li>
</ul>
<p>The simplified Jacobian being offset does not move the plateau — it just doesn't lie on it.</p>
<h1><a class="anchor" id="sja_convergence"></a>
What Happens Near Convergence</h1>
<p>As <a class="el" href="namespaceICP.html">ICP</a> converges:  </p><p class="formulaDsp">
\[
  a \to 0, \qquad r \to 0
\]
</p>
<p>Then the missing term:  </p><p class="formulaDsp">
\[
  -\frac{a}{b^2}\frac{\partial b}{\partial \boldsymbol{\omega}} \to 0
\]
</p>
<p>As a result:</p><ul>
<li>Simplified and consistent Jacobians become closer</li>
<li>The simplified approximation may appear to work near convergence</li>
</ul>
<p>This explains why simplified models sometimes converge, but are less reliable earlier in the solve when \(|a|\) is large.</p>
<h1><a class="anchor" id="sja_conclusion"></a>
Conclusion</h1>
<ul>
<li>The FD sweep is correct</li>
<li>The consistent Jacobian is correct</li>
<li>The simplified Jacobian differs by exactly the expected missing term</li>
<li>The magnitude and pattern of error match theory</li>
</ul>
<p>There is no bug — this is precisely the behavior predicted by the math. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
